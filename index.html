<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Roleta da Sorte - Ajustada</title>
<style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height:100vh;
        background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
        display:flex;align-items:center;justify-content:center;padding:20px;
    }
    .container{
        background:#fff;border-radius:24px;box-shadow:0 20px 60px rgba(0,0,0,.3);
        padding:40px;max-width:520px;width:100%;
    }
    h1{text-align:center;color:#333;margin-bottom:10px;font-size:32px}
    .subtitle{text-align:center;color:#666;margin-bottom:30px}
    .form-group{margin-bottom:16px}
    label{display:block;margin-bottom:8px;color:#333;font-weight:500}
    label .obrigatorio{color:#dc3545}
    input{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:16px;transition:border-color .3s}
    input:focus{outline:none;border-color:#667eea}
    input.erro{border-color:#dc3545}
    .msg-erro{color:#dc3545;font-size:14px;margin-top:5px;display:none}
    .btn{width:100%;padding:16px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;border-radius:12px;font-size:18px;font-weight:700;cursor:pointer;transition:transform .2s,box-shadow .2s}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(102,126,234,.4)}
    .btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
    .roleta-container{text-align:center}
    .roleta-wrapper{position:relative;width:380px;height:380px;margin:30px auto}
    .seta{position:absolute;top:-30px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:30px solid transparent;border-right:30px solid transparent;border-top:60px solid #ffd700;z-index:10;filter:drop-shadow(0 5px 10px rgba(0,0,0,.5))}
    .roleta{width:100%;height:100%;border-radius:50%;position:relative;background:#fff;box-shadow:0 0 0 15px #D4AF37,0 0 0 18px #333,0 15px 50px rgba(0,0,0,.5);overflow:visible}
    /* transition moved to roleta-inner (corre√ß√£o) */
    .roleta-inner{
        width:100%;height:100%;border-radius:50%;position:absolute;top:0;left:0;
        overflow: visible; /* importante para evitar corte do texto */
        transition: transform 8s cubic-bezier(.17,.67,.12,.99); /* DURA√á√ÉO: 8s - ajustada conforme seu coment√°rio */
        transform-origin:center center;
    }

    .fatia{position:absolute;width:50%;height:50%;transform-origin:100% 100%;clip-path:polygon(0% 0%,100% 0%,100% 100%);overflow:visible}

    /* estilo do texto das fatias ‚Äî reposicionado para n√£o cortar letras */
    .fatia-text{
        position:absolute;
        left:50%;
        top:24%;
        transform-origin:center center;
        transform: translateX(-50%) rotate(0deg) skewY(45deg);
        width:auto;
        padding:0 6px;
        font-weight:700;
        font-size:20px;
        text-align:center;
        text-transform:uppercase;
        white-space:nowrap;
        color:#000;
        pointer-events:none;
    }

    .centro{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100px;height:100px;background:radial-gradient(circle,#FFD700 0%,#FFA500 50%,#FF8C00 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;cursor:pointer;box-shadow:0 0 0 5px #333,0 8px 20px rgba(0,0,0,.5);border:3px solid #D4AF37;z-index:5;transition:all .2s;font-size:20px}
    .centro:hover{transform:translate(-50%,-50%) scale(1.05)}
    .centro.girando{pointer-events:none;opacity:.8}
    .resultado-container{text-align:center}
    .resultado-icon{font-size:80px;margin-bottom:20px}
    .resultado-titulo{font-size:32px;color:#333;margin-bottom:10px}
    .resultado-premio{font-size:48px;color:#667eea;font-weight:700;margin:20px 0}
    .resultado-msg{color:#666;margin-bottom:30px;font-size:18px}
    .hidden{display:none}
</style>
</head>
<body>
<div class="container">
    <!-- Formul√°rio -->
    <div id="formulario">
        <h1>Roleta da Sorte</h1>
        <p class="subtitle">Preencha seus dados e concorra a pr√™mios!</p>

        <div class="form-group">
            <label>Nome Completo <span class="obrigatorio">*</span></label>
            <input type="text" id="nome" placeholder="Digite seu nome completo">
            <div class="msg-erro" id="erroNome">Por favor, preencha seu nome</div>
        </div>

        <div class="form-group">
            <label>Telefone <span class="obrigatorio">*</span></label>
            <input type="tel" id="telefone" placeholder="(00) 00000-0000" maxlength="15">
            <div class="msg-erro" id="erroTelefone">Por favor, preencha seu telefone</div>
        </div>

        <div class="form-group">
            <label>CEP <span class="obrigatorio">*</span></label>
            <input type="text" id="cep" placeholder="00000-000" maxlength="9">
            <div class="msg-erro" id="erroCep">Por favor, preencha seu CEP</div>
        </div>

        <div class="form-group">
            <label>Rua <span class="obrigatorio">*</span></label>
            <input type="text" id="rua" placeholder="Digite o nome da rua">
            <div class="msg-erro" id="erroRua">Por favor, preencha o nome da rua</div>
        </div>

        <div class="form-group">
            <label>N√∫mero <span class="obrigatorio">*</span></label>
            <input type="text" id="numero" placeholder="Digite o n√∫mero">
            <div class="msg-erro" id="erroNumero">Por favor, preencha o n√∫mero</div>
        </div>

        <button class="btn" onclick="avancarParaRoleta()">Girar a Roleta!</button>
    </div>

    <!-- Roleta -->
    <div id="roletaDiv" class="hidden roleta-container">
        <h1 id="saudacao">Boa sorte!</h1>

        <div class="roleta-wrapper">
            <div class="seta"></div>

            <div class="roleta">
                <div class="roleta-inner" id="roletaInner"></div>
            </div>

            <div class="centro" id="btnGirar" onclick="girarRoleta()">GIRAR</div>
        </div>
    </div>

    <!-- Resultado -->
    <div id="resultado" class="hidden resultado-container">
        <div class="resultado-icon">üéâ</div>
        <h2 class="resultado-titulo">Parab√©ns!</h2>
        <p class="resultado-msg">Voc√™ ganhou:</p>
        <div class="resultado-premio" id="premioGanho"></div>
        <p class="resultado-msg">Dirija-se ao balc√£o para retirar seu pr√™mio!</p>
        <button class="btn" onclick="reiniciar()">Pr√≥ximo Participante</button>
    </div>
</div>

<script>
/* ===== Configs ===== */
const DURATION_MS = 8000; // dura√ß√£o do giro em ms (8s ‚Äî ajustado para ser mais r√°pido que 10s)
const ANGLE_PER = 360 / 4; // 4 fatias
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzojpuOhfwH1TfSKe0ITynGAVVa4xVQwwneCUvw1A5wqdbf-jhag_CvFHyaBxCWObYgsw/exec';

/* ===== Estado ===== */
let premios = {
    'Caneta': { total: 600, distribuidos: 0, peso: 30 },
    'Copo': { total: 100, distribuidos: 0, peso: 3 },
    'Almofada': { total: 50, distribuidos: 0, peso: 1.5 },
    'Fone': { total: 50, distribuidos: 0, peso: 1 }
};

let formData = {};
let girando = false;
let rotacaoAtual = 0; // em graus

window.onload = function(){
    criarRoleta();
    aplicarMascaras();
};

/* ===== M√°scaras (telefone/CEP) ===== */
function aplicarMascaras(){
    document.getElementById('telefone').addEventListener('input', function(e){
        let v = e.target.value.replace(/\D/g,'');
        if (v.length <= 11) {
            v = v.replace(/^(\d{2})(\d)/g,'($1) $2');
            v = v.replace(/(\d)(\d{4})$/,'$1-$2');
        }
        e.target.value = v;
    });

    document.getElementById('cep').addEventListener('input', function(e){
        let v = e.target.value.replace(/\D/g,'');
        if (v.length <= 8) v = v.replace(/^(\d{5})(\d)/,'$1-$2');
        e.target.value = v;
    });
}

/* ===== Constru√ß√£o da roleta (fatias e texto) ===== */
function criarRoleta(){
    const container = document.getElementById('roletaInner');
    container.innerHTML = '';
    const nomes = ['CANETA','COPO','ALMOFADA','FONE'];

    nomes.forEach((nome, i) => {
        const fatia = document.createElement('div');
        fatia.className = 'fatia';
        const cor = i % 2 === 0 ? '#FFFFFF' : '#DC143C';

        // rotaciona cada fatia
        fatia.style.transform = `rotate(${ANGLE_PER * i}deg) skewY(-45deg)`;
        fatia.style.left = '50%';
        fatia.style.top = '50%';

        const texto = document.createElement('div');
        texto.className = 'fatia-text';
        texto.textContent = nome;

        // Ajuste: colocamos o texto sempre centralizado horizontalmente (left:50% + translateX)
        // e deixamos ele mais perto do centro com top em porcentagem para evitar corte.
        // Como overflow √© visible, a primeira letra n√£o ser√° cortada.
        fatia.appendChild(texto);
        container.appendChild(fatia);
    });
}

/* ===== Valida√ß√µes simples ===== */
function validarCampo(id, msgId){
    const campo = document.getElementById(id);
    const msg = document.getElementById(msgId);
    if (!campo.value || !campo.value.trim()){
        campo.classList.add('erro');
        msg.style.display = 'block';
        return false;
    }
    campo.classList.remove('erro');
    msg.style.display = 'none';
    return true;
}

function avancarParaRoleta(){
    const ok = validarCampo('nome','erroNome') &
               validarCampo('telefone','erroTelefone') &
               validarCampo('cep','erroCep') &
               validarCampo('rua','erroRua') &
               validarCampo('numero','erroNumero');

    if (!ok) return;

    formData = {
        nome: document.getElementById('nome').value.trim(),
        telefone: document.getElementById('telefone').value.trim(),
        cep: document.getElementById('cep').value.trim(),
        rua: document.getElementById('rua').value.trim(),
        numero: document.getElementById('numero').value.trim()
    };

    document.getElementById('formulario').classList.add('hidden');
    document.getElementById('roletaDiv').classList.remove('hidden');
    document.getElementById('saudacao').textContent = 'Boa sorte, ' + formData.nome.split(' ')[0] + '!';
}

/* ===== Sele√ß√£o ponderada do pr√™mio ===== */
function sortearPremio(){
    const disponiveis = Object.entries(premios).filter(([_, info]) => info.distribuidos < info.total);
    if (disponiveis.length === 0) return null;

    const pesoTotal = disponiveis.reduce((acc, [_, info]) => acc + info.peso, 0);
    let r = Math.random() * pesoTotal;

    for (const [nome, info] of disponiveis){
        r -= info.peso;
        if (r <= 0) return nome;
    }
    return disponiveis[0][0];
}

/* ===== Giro da roleta (corre√ß√µes de sincroniza√ß√£o e precis√£o) ===== */
function girarRoleta(){
    if (girando) return;

    const premio = sortearPremio();
    if (!premio){
        alert('Sem pr√™mios dispon√≠veis.');
        return;
    }

    girando = true;
    const btn = document.getElementById('btnGirar');
    btn.classList.add('girando');
    btn.textContent = '...';

    // mapping consistente entre nomes / √≠ndices
    const nomes = ['CANETA','COPO','ALMOFADA','FONE'];
    const index = nomes.indexOf(premio.toUpperCase());
    if (index < 0) {
        console.error('Pr√™mio inv√°lido:', premio);
    }

    // spins aleat√≥rios para variar a anima√ß√£o (mantemos visual agrad√°vel)
    const spins = 4 + Math.floor(Math.random() * 3); // 4 a 6 voltas completas

    // c√°lculo do √¢ngulo alvo:
    // queremos que o centro da fatia selecionada fique apontando para a "seta" (topo).
    // cada fatia tem ANGLE_PER graus; o centro da fatia √© index*ANGLE_PER + ANGLE_PER/2.
    // para girar de forma "aumentativa" a partir de rotacaoAtual, calculamos:
    // novoAlvo = rotacaoAtual + spins*360 + (360 - (index*ANGLE_PER + ANGLE_PER/2))
    // simplificamos para:
    const centerOfSlice = index * ANGLE_PER + (ANGLE_PER / 2);
    const novoAlvo = rotacaoAtual + (spins * 360) + (360 - centerOfSlice);

    // aplicar transforma√ß√£o no elemento correto (roletaInner) ‚Äî isso garante que a transi√ß√£o CSS seja usada
    const roletaInner = document.getElementById('roletaInner');
    // for√ßa reflow leve (reduz problemas em alguns browsers ao reaplicar transform)
    roletaInner.style.transition = `transform ${DURATION_MS}ms cubic-bezier(.17,.67,.12,.99)`;
    requestAnimationFrame(() => {
        roletaInner.style.transform = `rotate(${novoAlvo}deg)`;
    });

    // Atualiza estado (normaliza entre 0-360)
    rotacaoAtual = novoAlvo % 360;

    // sincroniza tempo de exibi√ß√£o com DURATION_MS (para garantir que o resultado s√≥ apare√ßa depois do giro)
    setTimeout(() => {
        // incrementa contagem do pr√™mio sorteado
        premios[premio].distribuidos++;

        // envia dados (sem-cors) - se preferir testar, remova mode: 'no-cors' e use servidor com CORS habilitado
        enviarParaGoogleSheets(premio);

        // mostra resultado
        document.getElementById('roletaDiv').classList.add('hidden');
        document.getElementById('resultado').classList.remove('hidden');
        document.getElementById('premioGanho').textContent = premio;

        // reset bot√£o
        btn.classList.remove('girando');
        btn.textContent = 'GIRAR';
        girando = false;
    }, DURATION_MS + 50); // pequeno buffer
}

/* ===== Envio para Google Sheets ===== */
function enviarParaGoogleSheets(premio){
    try{
        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({
                ...formData,
                premio,
                data: new Date().toLocaleString('pt-BR')
            })
        }).catch(e => console.log('Erro fetch (prov√°vel modo no-cors):', e));
    }catch(e){ console.log('Erro ao enviar:', e) }
}

/* ===== Reiniciar para pr√≥ximo participante ===== */
function reiniciar(){
    document.getElementById('nome').value = '';
    document.getElementById('telefone').value = '';
    document.getElementById('cep').value = '';
    document.getElementById('rua').value = '';
    document.getElementById('numero').value = '';

    document.querySelectorAll('.erro').forEach(el => el.classList.remove('erro'));
    document.querySelectorAll('.msg-erro').forEach(el => el.style.display = 'none');

    document.getElementById('resultado').classList.add('hidden');
    document.getElementById('formulario').classList.remove('hidden');
}
</script>
</body>
</html>
