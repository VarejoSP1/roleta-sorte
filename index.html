<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roleta da Sorte</title>

<style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
        font-family:'Segoe UI', Tahoma, sans-serif;
        min-height:100vh;
        background:linear-gradient(135deg,#667eea,#764ba2);
        display:flex;align-items:center;justify-content:center;
        padding:20px;
    }

    .container{
        background:#fff;
        border-radius:24px;
        box-shadow:0 20px 60px rgba(0,0,0,.3);
        padding:40px;
        max-width:500px;width:100%;
    }

    h1{text-align:center;margin-bottom:10px;color:#333}
    .subtitle{text-align:center;color:#666;margin-bottom:30px}

    .form-group{margin-bottom:16px}
    label{font-weight:500;margin-bottom:6px;display:block}
    input{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:16px}
    input:focus{border-color:#667eea;outline:none}
    input.erro{border-color:#dc3545}

    .msg-erro{color:#dc3545;font-size:14px;margin-top:5px;display:none}

    .btn{
        width:100%;padding:16px;
        background:linear-gradient(135deg,#667eea,#764ba2);
        border:none;border-radius:12px;
        color:#fff;font-size:18px;font-weight:700;
        cursor:pointer;margin-top:10px;
    }

    .roleta-container{text-align:center}
    .roleta-wrapper{
        position:relative;
        width:380px;height:380px;
        margin:30px auto;
    }

    .seta{
        position:absolute;
        top:-35px;left:50%;
        transform:translateX(-50%);
        width:0;height:0;
        border-left:25px solid transparent;
        border-right:25px solid transparent;
        border-top:50px solid #ffd700;
        z-index:10;
    }

    .roleta{
        width:100%;height:100%;
        border-radius:50%;
        background:#fff;
        box-shadow:
            0 0 0 15px #D4AF37,
            0 0 0 18px #333;
        position:relative;
        overflow:hidden;
    }

    .roleta-inner{
        width:100%;height:100%;
        border-radius:50%;
        position:absolute;
        top:0;left:0;
        transform-origin:center;
        transition:transform 8s cubic-bezier(.17,.67,.12,.99);
    }

    /* FATIAS SIMPLES (BRANCO / VERMELHO) */
    .fatia{
        position:absolute;
        width:50%;height:50%;
        top:50%;left:50%;
        transform-origin:0 0;
        clip-path:polygon(0 0,100% 0,0 100%);
    }

    /* Texto reto e horizontal */
    .fatia-text{
        position:absolute;
        top:20%;
        left:-5%;
        width:140px;
        font-size:20px;
        font-weight:700;
        text-align:center;
        transform:rotate(0deg);
        white-space:nowrap;
    }

    .centro{
        position:absolute;
        top:50%;left:50%;
        transform:translate(-50%,-50%);
        width:100px;height:100px;
        border-radius:50%;
        background:radial-gradient(circle,#FFD700,#FF8C00);
        border:3px solid #D4AF37;
        display:flex;align-items:center;justify-content:center;
        font-weight:700;color:#fff;font-size:20px;
        box-shadow:0 0 0 5px #333;
        cursor:pointer;
        z-index:5;
    }

    .centro.girando{opacity:.7;pointer-events:none}

    .resultado-container{text-align:center}
    .resultado-premio{font-size:48px;margin:20px 0;color:#667eea;font-weight:700}

    .hidden{display:none}
</style>
</head>

<body>
<div class="container">

    <!-- FORMULÁRIO -->
    <div id="formulario">
        <h1>Roleta da Sorte</h1>
        <p class="subtitle">Preencha seus dados e concorra a prêmios!</p>

        <div class="form-group">
            <label>Nome Completo *</label>
            <input type="text" id="nome">
            <div id="erroNome" class="msg-erro">Preencha seu nome</div>
        </div>

        <div class="form-group">
            <label>Telefone *</label>
            <input type="tel" id="telefone" maxlength="15">
            <div id="erroTelefone" class="msg-erro">Preencha seu telefone</div>
        </div>

        <div class="form-group">
            <label>CEP *</label>
            <input type="text" id="cep" maxlength="9">
            <div id="erroCep" class="msg-erro">Preencha seu CEP</div>
        </div>

        <div class="form-group">
            <label>Rua *</label>
            <input type="text" id="rua">
            <div id="erroRua" class="msg-erro">Preencha sua rua</div>
        </div>

        <div class="form-group">
            <label>Número *</label>
            <input type="text" id="numero">
            <div id="erroNumero" class="msg-erro">Preencha o número</div>
        </div>

        <button class="btn" onclick="avancarParaRoleta()">Girar a Roleta!</button>
    </div>

    <!-- ROLETA -->
    <div id="roletaDiv" class="hidden roleta-container">
        <h1 id="saudacao">Boa sorte!</h1>

        <div class="roleta-wrapper">
            <div class="seta"></div>

            <div class="roleta">
                <div id="roletaInner" class="roleta-inner"></div>
            </div>

            <div id="btnGirar" class="centro" onclick="girarRoleta()">GIRAR</div>
        </div>
    </div>

    <!-- RESULTADO -->
    <div id="resultado" class="hidden resultado-container">
        <h2 class="resultado-titulo">Parabéns!</h2>
        <p class="resultado-msg">Você ganhou:</p>
        <div class="resultado-premio" id="premioGanho"></div>
        <p class="resultado-msg">Dirija-se ao balcão para retirar seu prêmio.</p>
        <button class="btn" onclick="reiniciar()">Próximo Participante</button>
    </div>

</div>

<script>
/* CONFIGURAÇÃO DOS PRÊMIOS */
let premios = {
    'Caneta': { total: 600, distribuidos: 0, peso: 30 },
    'Copo': { total: 100, distribuidos: 0, peso: 3 },
    'Almofada': { total: 50, distribuidos: 0, peso: 1.5 },
    'Fone': { total: 50, distribuidos: 0, peso: 1 }
};

let rotacaoAtual = 0;
let girando = false;
let formData = {};

const ANGULO_FATIA = 360 / 4;
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbzojpuOhfwH1TfSKe0ITynGAVVa4xVQwwneCUvw1A5wqdbf-jhag_CvFHyaBxCWObYgsw/exec";

/* MÁSCARAS */
document.getElementById('telefone').addEventListener('input', e=>{
    let v=e.target.value.replace(/\D/g,'');
    v=v.replace(/^(\d{2})(\d)/g,'($1) $2');
    v=v.replace(/(\d)(\d{4})$/,'$1-$2');
    e.target.value=v;
});
document.getElementById('cep').addEventListener('input', e=>{
    let v=e.target.value.replace(/\D/g,'');
    v=v.replace(/^(\d{5})(\d)/,'$1-$2');
    e.target.value=v;
});

/* CRIA FATIAS */
function criarRoleta(){
    const container=document.getElementById('roletaInner');
    container.innerHTML='';

    const nomes=['CANETA','COPO','ALMOFADA','FONE'];

    nomes.forEach((nome,i)=>{
        const fatia=document.createElement('div');
        fatia.className="fatia";
        fatia.style.background = i%2===0 ? "#FFF" : "#DC143C";
        fatia.style.transform=`rotate(${i*ANGULO_FATIA}deg)`;

        const texto=document.createElement('div');
        texto.className="fatia-text";
        texto.textContent=nome;

        fatia.appendChild(texto);
        container.appendChild(fatia);
    });
}
criarRoleta();

/* VALIDAÇÕES */
function validar(id,erro){
    const el=document.getElementById(id);
    const msg=document.getElementById(erro);
    if(!el.value.trim()){
        el.classList.add('erro'); msg.style.display='block'; return false;
    }
    el.classList.remove('erro'); msg.style.display='none';
    return true;
}

/* AVANÇAR */
function avancarParaRoleta(){
    let ok=
        validar('nome','erroNome') &
        validar('telefone','erroTelefone') &
        validar('cep','erroCep') &
        validar('rua','erroRua') &
        validar('numero','erroNumero');

    if(!ok) return;

    formData={
        nome:nome.value.trim(),
        telefone:telefone.value.trim(),
        cep:cep.value.trim(),
        rua:rua.value.trim(),
        numero:numero.value.trim()
    };

    formulario.classList.add('hidden');
    roletaDiv.classList.remove('hidden');
    saudacao.textContent = "Boa sorte, "+formData.nome.split(' ')[0]+"!";
}

/* SORTEIO */
function sortearPremio(){
    const items=Object.entries(premios).filter(([n,i])=>i.distribuidos<i.total);
    let totalPeso=items.reduce((acc,[n,i])=>acc+i.peso,0);
    let r=Math.random()*totalPeso;

    for(let [nome,info] of items){
        r-=info.peso;
        if(r<=0) return nome;
    }
    return items[0][0];
}

/* GIRO DA ROLETA */
function girarRoleta(){
    if(girando) return;

    const premio=sortearPremio();
    if(!premio) return alert("Todos os prêmios acabaram");

    girando=true;
    btnGirar.classList.add("girando");
    btnGirar.textContent="...";

    const nomes=['CANETA','COPO','ALMOFADA','FONE'];
    const idx=nomes.indexOf(premio.toUpperCase());
    const centro = idx * ANGULO_FATIA + ANGULO_FATIA/2;

    const voltas = 6; 
    const alvo=rotacaoAtual + (voltas*360) + (360 - centro);

    roletaInner.style.transform = `rotate(${alvo}deg)`;
    rotacaoAtual = alvo % 360;

    setTimeout(()=>{
        premios[premio].distribuidos++;

        fetch(SCRIPT_URL,{
            method:'POST',
            mode:'no-cors',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({...formData,premio,data:new Date().toLocaleString('pt-BR')})
        });

        roletaDiv.classList.add('hidden');
        resultado.classList.remove('hidden');
        premioGanho.textContent = premio;

        girando=false;
        btnGirar.classList.remove("girando");
        btnGirar.textContent="GIRAR";

    },8000); 
}

/* REINICIAR */
function reiniciar(){
    nome.value="";telefone.value="";cep.value="";rua.value="";numero.value="";
    document.querySelectorAll('.msg-erro').forEach(e=>e.style.display='none');
    document.querySelectorAll('.erro').forEach(e=>e.classList.remove('erro'));

    resultado.classList.add('hidden');
    formulario.classList.remove('hidden');
}
</script>

</body>
</html>
